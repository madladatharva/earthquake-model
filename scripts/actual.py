import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from io import StringIO

# 1. Load your data
csv_data = """Year,From_Cluster,To_Cluster,From_Time,To_Time,From_Lat,From_Lon,To_Lat,To_Lon,Bearing_Degrees,Angle_wrt_X_Axis,Direction
1980,1,2,1980-02-22,1980-07-29,30.581,88.739,29.422,80.871,262.33,187.67,W
1980,2,3,1980-07-29,1980-11-18,29.422,80.871,29.575,85.197,86.61,3.39,E
1984,1,2,1984-03-14,1984-05-19,29.265,80.990,29.325,81.694,84.18,5.82,E
1984,2,3,1984-05-19,1984-06-09,29.325,81.694,26.868,92.573,101.75,348.25,E
1985,1,2,1985-06-17,1985-10-12,31.563,82.303,27.126,92.458,114.06,335.94,SE
1985,2,3,1985-10-12,1985-12-08,27.126,92.458,30.849,86.537,307.12,142.88,NW
1986,1,2,1986-01-25,1986-05-22,31.594,85.068,31.636,91.142,87.94,2.06,E
1986,2,3,1986-05-22,1986-06-23,31.636,91.142,31.176,86.788,264.07,185.93,W
1987,1,2,1987-01-19,1987-01-24,28.314,83.627,27.561,92.838,93.11,356.89,E
1987,2,3,1987-01-24,1987-04-23,27.561,92.838,28.105,86.920,277.31,172.69,W
1987,3,4,1987-04-23,1987-06-06,28.105,86.920,30.512,79.234,291.61,158.39,W
1987,4,5,1987-06-06,1987-09-25,30.512,79.234,29.812,90.373,91.34,358.66,E
1988,1,2,1988-01-23,1988-04-11,29.239,81.478,27.693,85.753,111.33,338.67,E
1988,2,3,1988-04-11,1988-04-25,27.693,85.753,26.721,86.634,140.95,309.05,SE
1988,3,4,1988-04-25,1988-05-26,26.721,86.634,27.295,88.425,69.82,20.18,E
1989,1,2,1989-02-03,1989-02-04,30.191,90.057,30.071,90.077,171.58,278.42,S
1989,2,3,1989-02-04,1989-02-28,30.071,90.077,26.966,92.719,142.59,307.41,SE
1989,3,4,1989-02-28,1989-03-01,26.966,92.719,28.096,83.991,280.31,169.69,W
1990,1,2,1990-02-18,1990-05-13,29.199,90.072,32.345,92.823,36.22,53.78,NE
1990,2,3,1990-05-13,1990-05-20,32.345,92.823,28.285,83.160,246.55,203.45,SW
1990,3,4,1990-05-20,1990-09-02,28.285,83.160,26.632,92.626,98.92,351.08,E
1990,4,5,1990-09-02,1990-10-14,26.632,92.626,30.777,86.308,308.29,141.71,NW
1991,1,2,1991-02-12,1991-05-18,30.603,79.455,31.664,80.092,27.01,62.99,NE
1991,2,3,1991-05-18,1991-05-20,31.664,80.092,31.190,86.703,93.07,356.93,E
1991,3,4,1991-05-20,1991-05-26,31.190,86.703,29.318,80.305,252.92,197.08,W
1991,4,5,1991-05-26,1991-08-16,29.318,80.305,30.787,78.742,317.75,132.25,NW
1992,1,2,1992-03-02,1992-07-30,30.736,78.512,29.865,90.290,91.9,358.1,E
1992,2,3,1992-07-30,1992-10-31,29.865,90.290,27.645,93.005,132.35,317.65,SE
1993,1,2,1993-01-18,1993-01-18,30.869,90.329,31.126,90.018,313.99,136.01,NW
1993,2,3,1993-01-18,1993-03-20,31.126,90.018,29.042,87.366,228.43,221.57,SW
1993,3,4,1993-03-20,1993-04-12,29.042,87.366,28.257,82.831,259.93,190.07,W
1993,4,5,1993-04-12,1993-06-23,28.257,82.831,27.675,92.777,91.44,358.56,E
1993,5,6,1993-06-23,1993-07-03,27.675,92.777,28.423,86.737,279.4,170.6,W
1993,6,7,1993-07-03,1993-07-06,28.423,86.737,31.876,81.975,311.17,138.83,NW
1993,7,8,1993-07-06,1993-09-12,31.876,81.975,31.176,83.737,114.54,335.46,SE
1993,8,9,1993-09-12,1993-10-20,31.176,83.737,28.749,82.268,208.05,241.95,SW
2002,1,2,2002-01-27,2002-05-03,29.859,87.919,30.796,86.329,304.73,145.27,NW
2002,2,3,2002-05-03,2002-06-04,30.796,86.329,30.436,81.34,266.49,183.51,W
2002,3,4,2002-06-04,2002-06-04,30.436,81.34,30.372,81.334,184.61,265.39,S
2002,4,5,2002-06-04,2002-07-16,30.372,81.334,27.990,87.472,112.45,337.55,E
2005,4,5,2005-03-06,2005-04-07,30.272,83.510,29.336,81.431,243.1,206.9,SW
2005,5,6,2005-04-07,2005-04-07,29.336,81.431,30.425,83.713,60.61,29.39,NE
"""

# Load Data
df = pd.read_csv(StringIO(csv_data))

# --- CORE LOGIC: GENERATE PATH POINTS ---
# To visualize the "Stress Zone" (the path), we interpolate points between Start and End.
path_lats = []
path_lons = []

def interpolate_path(row, num_points=50):
    # Create 50 points linearly spaced between From_Lat/Lon and To_Lat/Lon
    lats = np.linspace(row['From_Lat'], row['To_Lat'], num_points)
    lons = np.linspace(row['From_Lon'], row['To_Lon'], num_points)
    return lats, lons

for index, row in df.iterrows():
    lats, lons = interpolate_path(row)
    path_lats.extend(lats)
    path_lons.extend(lons)

# --- VISUALIZATION ---
plt.figure(figsize=(12, 10))

# 1. The Stress Heatmap (Using the Interpolated Path Points)
# This shows the "Highways" of stress transfer
sns.kdeplot(x=path_lons, y=path_lats, cmap="inferno", fill=True, thresh=0.05, alpha=0.7)

# 2. Overlay the actual Paths (Thin lines to show direction)
for index, row in df.iterrows():
    plt.plot([row['From_Lon'], row['To_Lon']], 
             [row['From_Lat'], row['To_Lat']], 
             c='white', alpha=0.15, linewidth=0.8)

# 3. Overlay the Clusters (Start and End points)
plt.scatter(df['From_Lon'], df['From_Lat'], c='cyan', s=10, alpha=0.5, label='Trigger Cluster')
plt.scatter(df['To_Lon'], df['To_Lat'], c='red', s=10, alpha=0.5, label='Target Cluster')

plt.title("Seismic Stress Migration Density (1980-2005)\nHeatmap represents the 'Stress Zones' connecting clusters", fontsize=14)
plt.xlabel("Longitude")
plt.ylabel("Latitude")
plt.legend()
plt.grid(True, alpha=0.3)

plt.show()